<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="author" content="David Hugh-Jones davidhughjones@gmail.com" />

<meta name="date" content="2014-12-16" />

<title>refset - subsets with reference semantics</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; }
code > span.dt { color: #902000; }
code > span.dv { color: #40a070; }
code > span.bn { color: #40a070; }
code > span.fl { color: #40a070; }
code > span.ch { color: #4070a0; }
code > span.st { color: #4070a0; }
code > span.co { color: #60a0b0; font-style: italic; }
code > span.ot { color: #007020; }
code > span.al { color: #ff0000; font-weight: bold; }
code > span.fu { color: #06287e; }
code > span.er { color: #ff0000; font-weight: bold; }
</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>


<link href="data:text/css,body%20%7B%0A%20%20background%2Dcolor%3A%20%23fff%3B%0A%20%20margin%3A%201em%20auto%3B%0A%20%20max%2Dwidth%3A%20700px%3B%0A%20%20overflow%3A%20visible%3B%0A%20%20padding%2Dleft%3A%202em%3B%0A%20%20padding%2Dright%3A%202em%3B%0A%20%20font%2Dfamily%3A%20%22Open%20Sans%22%2C%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20Arial%2C%20sans%2Dserif%3B%0A%20%20font%2Dsize%3A%2014px%3B%0A%20%20line%2Dheight%3A%201%2E35%3B%0A%7D%0A%0A%23header%20%7B%0A%20%20text%2Dalign%3A%20center%3B%0A%7D%0A%0A%23TOC%20%7B%0A%20%20clear%3A%20both%3B%0A%20%20margin%3A%200%200%2010px%2010px%3B%0A%20%20padding%3A%204px%3B%0A%20%20width%3A%20400px%3B%0A%20%20border%3A%201px%20solid%20%23CCCCCC%3B%0A%20%20border%2Dradius%3A%205px%3B%0A%0A%20%20background%2Dcolor%3A%20%23f6f6f6%3B%0A%20%20font%2Dsize%3A%2013px%3B%0A%20%20line%2Dheight%3A%201%2E3%3B%0A%7D%0A%20%20%23TOC%20%2Etoctitle%20%7B%0A%20%20%20%20font%2Dweight%3A%20bold%3B%0A%20%20%20%20font%2Dsize%3A%2015px%3B%0A%20%20%20%20margin%2Dleft%3A%205px%3B%0A%20%20%7D%0A%0A%20%20%23TOC%20ul%20%7B%0A%20%20%20%20padding%2Dleft%3A%2040px%3B%0A%20%20%20%20margin%2Dleft%3A%20%2D1%2E5em%3B%0A%20%20%20%20margin%2Dtop%3A%205px%3B%0A%20%20%20%20margin%2Dbottom%3A%205px%3B%0A%20%20%7D%0A%20%20%23TOC%20ul%20ul%20%7B%0A%20%20%20%20margin%2Dleft%3A%20%2D2em%3B%0A%20%20%7D%0A%20%20%23TOC%20li%20%7B%0A%20%20%20%20line%2Dheight%3A%2016px%3B%0A%20%20%7D%0A%0Atable%20%7B%0A%20%20margin%3A%201em%20auto%3B%0A%20%20border%2Dwidth%3A%201px%3B%0A%20%20border%2Dcolor%3A%20%23DDDDDD%3B%0A%20%20border%2Dstyle%3A%20outset%3B%0A%20%20border%2Dcollapse%3A%20collapse%3B%0A%7D%0Atable%20th%20%7B%0A%20%20border%2Dwidth%3A%202px%3B%0A%20%20padding%3A%205px%3B%0A%20%20border%2Dstyle%3A%20inset%3B%0A%7D%0Atable%20td%20%7B%0A%20%20border%2Dwidth%3A%201px%3B%0A%20%20border%2Dstyle%3A%20inset%3B%0A%20%20line%2Dheight%3A%2018px%3B%0A%20%20padding%3A%205px%205px%3B%0A%7D%0Atable%2C%20table%20th%2C%20table%20td%20%7B%0A%20%20border%2Dleft%2Dstyle%3A%20none%3B%0A%20%20border%2Dright%2Dstyle%3A%20none%3B%0A%7D%0Atable%20thead%2C%20table%20tr%2Eeven%20%7B%0A%20%20background%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0A%0Ap%20%7B%0A%20%20margin%3A%200%2E5em%200%3B%0A%7D%0A%0Ablockquote%20%7B%0A%20%20background%2Dcolor%3A%20%23f6f6f6%3B%0A%20%20padding%3A%200%2E25em%200%2E75em%3B%0A%7D%0A%0Ahr%20%7B%0A%20%20border%2Dstyle%3A%20solid%3B%0A%20%20border%3A%20none%3B%0A%20%20border%2Dtop%3A%201px%20solid%20%23777%3B%0A%20%20margin%3A%2028px%200%3B%0A%7D%0A%0Adl%20%7B%0A%20%20margin%2Dleft%3A%200%3B%0A%7D%0A%20%20dl%20dd%20%7B%0A%20%20%20%20margin%2Dbottom%3A%2013px%3B%0A%20%20%20%20margin%2Dleft%3A%2013px%3B%0A%20%20%7D%0A%20%20dl%20dt%20%7B%0A%20%20%20%20font%2Dweight%3A%20bold%3B%0A%20%20%7D%0A%0Aul%20%7B%0A%20%20margin%2Dtop%3A%200%3B%0A%7D%0A%20%20ul%20li%20%7B%0A%20%20%20%20list%2Dstyle%3A%20circle%20outside%3B%0A%20%20%7D%0A%20%20ul%20ul%20%7B%0A%20%20%20%20margin%2Dbottom%3A%200%3B%0A%20%20%7D%0A%0Apre%2C%20code%20%7B%0A%20%20background%2Dcolor%3A%20%23f7f7f7%3B%0A%20%20border%2Dradius%3A%203px%3B%0A%20%20color%3A%20%23333%3B%0A%7D%0Apre%20%7B%0A%20%20white%2Dspace%3A%20pre%2Dwrap%3B%20%20%20%20%2F%2A%20Wrap%20long%20lines%20%2A%2F%0A%20%20border%2Dradius%3A%203px%3B%0A%20%20margin%3A%205px%200px%2010px%200px%3B%0A%20%20padding%3A%2010px%3B%0A%7D%0Apre%3Anot%28%5Bclass%5D%29%20%7B%0A%20%20background%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0A%0Acode%20%7B%0A%20%20font%2Dfamily%3A%20Consolas%2C%20Monaco%2C%20%27Courier%20New%27%2C%20monospace%3B%0A%20%20font%2Dsize%3A%2085%25%3B%0A%7D%0Ap%20%3E%20code%2C%20li%20%3E%20code%20%7B%0A%20%20padding%3A%202px%200px%3B%0A%7D%0A%0Adiv%2Efigure%20%7B%0A%20%20text%2Dalign%3A%20center%3B%0A%7D%0Aimg%20%7B%0A%20%20background%2Dcolor%3A%20%23FFFFFF%3B%0A%20%20padding%3A%202px%3B%0A%20%20border%3A%201px%20solid%20%23DDDDDD%3B%0A%20%20border%2Dradius%3A%203px%3B%0A%20%20border%3A%201px%20solid%20%23CCCCCC%3B%0A%20%20margin%3A%200%205px%3B%0A%7D%0A%0Ah1%20%7B%0A%20%20margin%2Dtop%3A%200%3B%0A%20%20font%2Dsize%3A%2035px%3B%0A%20%20line%2Dheight%3A%2040px%3B%0A%7D%0A%0Ah2%20%7B%0A%20%20border%2Dbottom%3A%204px%20solid%20%23f7f7f7%3B%0A%20%20padding%2Dtop%3A%2010px%3B%0A%20%20padding%2Dbottom%3A%202px%3B%0A%20%20font%2Dsize%3A%20145%25%3B%0A%7D%0A%0Ah3%20%7B%0A%20%20border%2Dbottom%3A%202px%20solid%20%23f7f7f7%3B%0A%20%20padding%2Dtop%3A%2010px%3B%0A%20%20font%2Dsize%3A%20120%25%3B%0A%7D%0A%0Ah4%20%7B%0A%20%20border%2Dbottom%3A%201px%20solid%20%23f7f7f7%3B%0A%20%20margin%2Dleft%3A%208px%3B%0A%20%20font%2Dsize%3A%20105%25%3B%0A%7D%0A%0Ah5%2C%20h6%20%7B%0A%20%20border%2Dbottom%3A%201px%20solid%20%23ccc%3B%0A%20%20font%2Dsize%3A%20105%25%3B%0A%7D%0A%0Aa%20%7B%0A%20%20color%3A%20%230033dd%3B%0A%20%20text%2Ddecoration%3A%20none%3B%0A%7D%0A%20%20a%3Ahover%20%7B%0A%20%20%20%20color%3A%20%236666ff%3B%20%7D%0A%20%20a%3Avisited%20%7B%0A%20%20%20%20color%3A%20%23800080%3B%20%7D%0A%20%20a%3Avisited%3Ahover%20%7B%0A%20%20%20%20color%3A%20%23BB00BB%3B%20%7D%0A%20%20a%5Bhref%5E%3D%22http%3A%22%5D%20%7B%0A%20%20%20%20text%2Ddecoration%3A%20underline%3B%20%7D%0A%20%20a%5Bhref%5E%3D%22https%3A%22%5D%20%7B%0A%20%20%20%20text%2Ddecoration%3A%20underline%3B%20%7D%0A%0A%2F%2A%20Class%20described%20in%20https%3A%2F%2Fbenjeffrey%2Ecom%2Fposts%2Fpandoc%2Dsyntax%2Dhighlighting%2Dcss%0A%20%20%20Colours%20from%20https%3A%2F%2Fgist%2Egithub%2Ecom%2Frobsimmons%2F1172277%20%2A%2F%0A%0Acode%20%3E%20span%2Ekw%20%7B%20color%3A%20%23555%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%2F%2A%20Keyword%20%2A%2F%0Acode%20%3E%20span%2Edt%20%7B%20color%3A%20%23902000%3B%20%7D%20%2F%2A%20DataType%20%2A%2F%0Acode%20%3E%20span%2Edv%20%7B%20color%3A%20%2340a070%3B%20%7D%20%2F%2A%20DecVal%20%28decimal%20values%29%20%2A%2F%0Acode%20%3E%20span%2Ebn%20%7B%20color%3A%20%23d14%3B%20%7D%20%2F%2A%20BaseN%20%2A%2F%0Acode%20%3E%20span%2Efl%20%7B%20color%3A%20%23d14%3B%20%7D%20%2F%2A%20Float%20%2A%2F%0Acode%20%3E%20span%2Ech%20%7B%20color%3A%20%23d14%3B%20%7D%20%2F%2A%20Char%20%2A%2F%0Acode%20%3E%20span%2Est%20%7B%20color%3A%20%23d14%3B%20%7D%20%2F%2A%20String%20%2A%2F%0Acode%20%3E%20span%2Eco%20%7B%20color%3A%20%23888888%3B%20font%2Dstyle%3A%20italic%3B%20%7D%20%2F%2A%20Comment%20%2A%2F%0Acode%20%3E%20span%2Eot%20%7B%20color%3A%20%23007020%3B%20%7D%20%2F%2A%20OtherToken%20%2A%2F%0Acode%20%3E%20span%2Eal%20%7B%20color%3A%20%23ff0000%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%2F%2A%20AlertToken%20%2A%2F%0Acode%20%3E%20span%2Efu%20%7B%20color%3A%20%23900%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%2F%2A%20Function%20calls%20%2A%2F%20%0Acode%20%3E%20span%2Eer%20%7B%20color%3A%20%23a61717%3B%20background%2Dcolor%3A%20%23e3d2d2%3B%20%7D%20%2F%2A%20ErrorTok%20%2A%2F%0A%0A" rel="stylesheet" type="text/css" />

</head>

<body>



<div id="header">
<h1 class="title">refset - subsets with reference semantics</h1>
<h4 class="author"><em>David Hugh-Jones <a href="mailto:davidhughjones@gmail.com">davidhughjones@gmail.com</a></em></h4>
<h4 class="date"><em>2014-12-16</em></h4>
</div>


<p><a href="https://travis-ci.org/hughjonesd/refset"><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI4MSIgaGVpZ2h0PSIyMCI+PGxpbmVhckdyYWRpZW50IGlkPSJhIiB4Mj0iMCIgeTI9IjEwMCUiPjxzdG9wIG9mZnNldD0iMCIgc3RvcC1jb2xvcj0iI2JiYiIgc3RvcC1vcGFjaXR5PSIuMSIvPjxzdG9wIG9mZnNldD0iMSIgc3RvcC1vcGFjaXR5PSIuMSIvPjwvbGluZWFyR3JhZGllbnQ+PHJlY3Qgcng9IjMiIHdpZHRoPSI4MSIgaGVpZ2h0PSIyMCIgZmlsbD0iIzU1NSIvPjxyZWN0IHJ4PSIzIiB4PSIzNyIgd2lkdGg9IjQ0IiBoZWlnaHQ9IjIwIiBmaWxsPSIjZTA1ZDQ0Ii8+PHBhdGggZmlsbD0iI2UwNWQ0NCIgZD0iTTM3IDBoNHYyMGgtNHoiLz48cmVjdCByeD0iMyIgd2lkdGg9IjgxIiBoZWlnaHQ9IjIwIiBmaWxsPSJ1cmwoI2EpIi8+PGcgZmlsbD0iI2ZmZiIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZm9udC1mYW1pbHk9IkRlamFWdSBTYW5zLFZlcmRhbmEsR2VuZXZhLHNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTEiPjx0ZXh0IHg9IjE5LjUiIHk9IjE1IiBmaWxsPSIjMDEwMTAxIiBmaWxsLW9wYWNpdHk9Ii4zIj5idWlsZDwvdGV4dD48dGV4dCB4PSIxOS41IiB5PSIxNCI+YnVpbGQ8L3RleHQ+PHRleHQgeD0iNTgiIHk9IjE1IiBmaWxsPSIjMDEwMTAxIiBmaWxsLW9wYWNpdHk9Ii4zIj5mYWlsaW5nPC90ZXh0Pjx0ZXh0IHg9IjU4IiB5PSIxNCI+ZmFpbGluZzwvdGV4dD48L2c+PC9zdmc+" alt="Build Status" /></a></p>
<div id="the-skinny" class="section level2">
<h2>The skinny</h2>
<div id="installation" class="section level3">
<h3>Installation</h3>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(devtools)
<span class="kw">install_github</span>(<span class="st">&quot;hughjonesd/refset&quot;</span>)</code></pre>
</div>
<div id="creating-a-refset" class="section level3">
<h3>Creating a refset</h3>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(refset)
employees &lt;-<span class="st"> </span><span class="kw">data.frame</span>(
      <span class="dt">id=</span><span class="dv">1</span>:<span class="dv">4</span>, 
      <span class="dt">name=</span><span class="kw">c</span>(<span class="st">&quot;James&quot;</span>, <span class="st">&quot;Sylvia&quot;</span>, <span class="st">&quot;Meng Qi&quot;</span>, <span class="st">&quot;Luis&quot;</span>), 
      <span class="dt">age=</span><span class="kw">c</span>(<span class="dv">28</span>,<span class="dv">44</span>,<span class="dv">38</span>, <span class="dv">23</span>), 
      <span class="dt">gender=</span><span class="kw">factor</span>(<span class="kw">c</span>(<span class="st">&quot;M&quot;</span>, <span class="st">&quot;F&quot;</span>, <span class="st">&quot;F&quot;</span>, <span class="st">&quot;M&quot;</span>)), 
      <span class="dt">stringsAsFactors=</span><span class="ot">FALSE</span>)
      
<span class="kw">refset</span>(rs, employees[<span class="dv">1</span>:<span class="dv">2</span>,])</code></pre>
</div>
<div id="refsets-refer-to-the-original" class="section level3">
<h3>Refsets refer to the original</h3>
<pre class="sourceCode r"><code class="sourceCode r">rs</code></pre>
<pre><code>##   id   name age gender
## 1  1  James  28      M
## 2  2 Sylvia  44      F</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">employees$name[<span class="dv">1</span>] &lt;-<span class="st"> &quot;Jimmy&quot;</span>
rs</code></pre>
<pre><code>##   id   name age gender
## 1  1  Jimmy  28      M
## 2  2 Sylvia  44      F</code></pre>
</div>
<div id="refsets-change-the-original" class="section level3">
<h3>Refsets change the original</h3>
<pre class="sourceCode r"><code class="sourceCode r">rs$age &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">29</span>, <span class="dv">45</span>)
employees$age</code></pre>
<pre><code>## [1] 29 45 38 23</code></pre>
</div>
<div id="assigning-to-a-new-variable-breaks-the-link" class="section level3">
<h3>Assigning to a new variable breaks the link</h3>
<pre class="sourceCode r"><code class="sourceCode r">ss &lt;-<span class="st"> </span>rs
employees$name[<span class="dv">2</span>] &lt;-<span class="st"> &quot;Silvia&quot;</span>
rs$name[<span class="dv">2</span>]</code></pre>
<pre><code>## [1] &quot;Silvia&quot;</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">ss$name[<span class="dv">2</span>]</code></pre>
<pre><code>## [1] &quot;Sylvia&quot;</code></pre>
</div>
<div id="you-can-have-refsets-of-refsets" class="section level3">
<h3>You can have refsets of refsets</h3>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">refset</span>(rs2, rs$id)
rs2 </code></pre>
<pre><code>## [1] 1 2</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">rs$id &lt;-<span class="st"> </span>rs$id +<span class="st"> </span><span class="dv">1000</span>
rs2</code></pre>
<pre><code>## [1] 1001 1002</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">rs2 &lt;-<span class="st"> </span><span class="dv">101</span>:<span class="dv">102</span>
employees$id</code></pre>
<pre><code>## [1] 101 102   3   4</code></pre>
</div>
<div id="refset-size-can-change-dynamically" class="section level3">
<h3>Refset size can change dynamically</h3>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># the multi-argument form. Note the empty argument, to select all columns:</span>
<span class="kw">refset</span>(rsd, employees, age &lt;<span class="st"> </span><span class="dv">30</span>, , <span class="dt">drop=</span><span class="ot">FALSE</span>)
rsd</code></pre>
<pre><code>##    id  name age gender
## 1 101 Jimmy  29      M
## 4   4  Luis  23      M</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">employees$age &lt;-<span class="st"> </span>employees$age +<span class="st"> </span><span class="dv">1</span>
rsd</code></pre>
<pre><code>##   id name age gender
## 4  4 Luis  24      M</code></pre>
</div>
<div id="you-can-refset-any-subsettable-object" class="section level3">
<h3>You can refset any subsettable object…</h3>
<pre class="sourceCode r"><code class="sourceCode r">vec &lt;-<span class="st"> </span><span class="dv">1</span>:<span class="dv">10</span>
<span class="kw">refset</span>(rs, vec, <span class="dv">4</span>:<span class="dv">6</span>)
rs &lt;-<span class="st"> </span>rs*<span class="dv">10</span>
vec</code></pre>
<pre><code>##  [1]  1  2  3 40 50 60  7  8  9 10</code></pre>
</div>
<div id="using-any-form-of-subsetting" class="section level3">
<h3>… using any form of subsetting</h3>
<pre class="sourceCode r"><code class="sourceCode r">lst &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">a=</span><span class="st">&quot;text&quot;</span>, <span class="dt">b=</span><span class="dv">42</span>, <span class="ot">NA</span>)
<span class="kw">refset</span>(rsl, lst$b)
rsl &lt;-<span class="st"> &quot;more text&quot;</span>
lst$b</code></pre>
<pre><code>## [1] &quot;more text&quot;</code></pre>
</div>
<div id="the-short-form" class="section level3">
<h3>The short form</h3>
<pre class="sourceCode r"><code class="sourceCode r">rs %r%<span class="st"> </span>employees[<span class="dv">1</span>:<span class="dv">3</span>,] <span class="co"># equivalent to refset(rs, employees[1:3,])</span></code></pre>
</div>
<div id="to-pass-a-refset-into-a-function-wrap-it" class="section level3">
<h3>To pass a refset into a function, wrap it</h3>
<pre class="sourceCode r"><code class="sourceCode r">f &lt;-<span class="st"> </span>function(x) {
  cx &lt;-<span class="st"> </span><span class="kw">contents</span>(x)
  <span class="kw">contents</span>(x)$name &lt;-<span class="st"> </span><span class="kw">paste</span>(cx$name, <span class="st">&quot;the&quot;</span>, <span class="kw">sample</span>(<span class="kw">c</span>(<span class="st">&quot;Kid&quot;</span>, <span class="st">&quot;Terrible&quot;</span>, <span class="st">&quot;Silent&quot;</span>, 
        <span class="st">&quot;Fair&quot;</span>), <span class="kw">nrow</span>(cx), <span class="dt">replace=</span><span class="ot">TRUE</span>))
}

parcel &lt;-<span class="st"> </span><span class="kw">wrap</span>(rs)
<span class="kw">f</span>(parcel)
employees</code></pre>
<pre><code>##    id                 name age gender
## 1 101        Jimmy the Kid  30      M
## 2 102  Silvia the Terrible  46      F
## 3   3 Meng Qi the Terrible  39      F
## 4   4                 Luis  24      M</code></pre>
</div>
</div>
<div id="introduction" class="section level2">
<h2>Introduction</h2>
<p>Normally, R uses “pass by value”. This means that when you run <code>b &lt;- a</code> you have two independent copies of the same data. Similarly, the code:</p>
<pre class="sourceCode r"><code class="sourceCode r">f &lt;-<span class="st"> </span>function(x) {x &lt;-<span class="st"> </span>x*<span class="dv">2</span>}
a &lt;-<span class="st"> </span><span class="dv">4</span>
<span class="kw">f</span>(a)
a</code></pre>
<pre><code>## [1] 4</code></pre>
<p>does not change the value of <code>a</code>, since the function <code>f</code> gets passed the contents of <code>a</code> rather than the variable <code>a</code> itself.</p>
<p>This is fine for most cases, especially for traditional uses of R in which the programmer or statistician passes in a value to a function, and sees the result on the command line. However, in some cases we would like to work with a single object, rather than multiple copies. For example:</p>
<ul>
<li>working on a complex dataset, an analyst may wish to work with part of the dataset, but to have any changes reflected in the whole data frame.</li>
<li>if a data frame represents objects in a relational database, changes to the database on disk should be reflected in the data frame.</li>
<li>for large datasets, assigning into multiple copies can take up memory.</li>
</ul>
<p>The refset package allows you to do this, by creating objects that refer to other objects, or subsets of them.</p>
<p>To create a refset, call refset with two arguments:</p>
<pre class="sourceCode r"><code class="sourceCode r">dfr &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">x1=</span><span class="dv">1</span>:<span class="dv">5</span>, <span class="dt">x2=</span><span class="kw">rnorm</span>(<span class="dv">5</span>), <span class="dt">alpha=</span>letters[<span class="dv">1</span>:<span class="dv">5</span>])
<span class="kw">refset</span>(rs, dfr[dfr$x1 &lt;=<span class="st"> </span><span class="dv">3</span>, <span class="kw">c</span>(<span class="st">&quot;x1&quot;</span>, <span class="st">&quot;alpha&quot;</span>)])</code></pre>
<p>The call above creates a new variable <code>rs</code> in your environment. (Strictly, it creates a new <em>binding</em>, but we needn’t worry about that for now.) For comparison, we’ll also create a standard subset.</p>
<pre class="sourceCode r"><code class="sourceCode r">ss &lt;-<span class="st"> </span>dfr[dfr$x1 &lt;=<span class="st"> </span><span class="dv">3</span>, <span class="kw">c</span>(<span class="st">&quot;x1&quot;</span>, <span class="st">&quot;alpha&quot;</span>)]
rs</code></pre>
<pre><code>##   x1 alpha
## 1  1     a
## 2  2     b
## 3  3     c</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">ss</code></pre>
<pre><code>##   x1 alpha
## 1  1     a
## 2  2     b
## 3  3     c</code></pre>
<p><code>rs</code> and <code>ss</code> look and behave just the same:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">c</span>(<span class="kw">class</span>(rs), <span class="kw">class</span>(ss))</code></pre>
<pre><code>## [1] &quot;data.frame&quot; &quot;data.frame&quot;</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">c</span>(<span class="kw">mean</span>(rs$x1), <span class="kw">mean</span>(ss$x1))</code></pre>
<pre><code>## [1] 2 2</code></pre>
<p>To see the difference, let’s change the data in <code>dfr</code>:</p>
<pre class="sourceCode r"><code class="sourceCode r">dfr$alpha &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="ot">NA</span>, letters[<span class="dv">23</span>:<span class="dv">26</span>])
rs</code></pre>
<pre><code>##   x1 alpha
## 1  1  &lt;NA&gt;
## 2  2     w
## 3  3     x</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">ss</code></pre>
<pre><code>##   x1 alpha
## 1  1     a
## 2  2     b
## 3  3     c</code></pre>
<p>As is normal, <code>ss</code> has not updated to reflect changes in the original data frame. But <code>rs</code> has.</p>
<p>The connection also works the other way, if you change <code>rs</code>.</p>
<pre class="sourceCode r"><code class="sourceCode r">rs$alpha &lt;-<span class="st"> </span>LETTERS[<span class="dv">1</span>:<span class="dv">3</span>]
rs</code></pre>
<pre><code>##   x1 alpha
## 1  1     A
## 2  2     B
## 3  3     C</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">dfr</code></pre>
<pre><code>##   x1         x2 alpha
## 1  1  1.5645495     A
## 2  2  0.8620767     B
## 3  3 -2.3977372     C
## 4  4 -0.8978086     y
## 5  5  1.7160819     z</code></pre>
<p>Everything that you do to <code>rs</code> will be reflected in the original data, and vice versa. Well, almost everything: remember that <code>rs</code> refers to a <em>subset</em> of the data. If you can’t do it to a subset, you probably can’t do it to a refset. For example, changing the <code>names</code> of a refset doesn’t work, because assigning to the names of a subset of your data doesn’t change the original names.</p>
</div>
<div id="ways-to-call-refset" class="section level2">
<h2>Ways to call refset</h2>
<p>There are three ways to create a refset. The first you have already seen: call <code>refset(name, data[indices])</code> where <code>name</code> is the variable name of the variable you want to create, and <code>data[indices]</code> is the subset you want to look at. You aren’t limited to using data frames. You can refset any object which you can subset, and you can use any of the three standard ways to subset data: <code>$</code>, <code>[[</code> and <code>[</code>.</p>
<pre class="sourceCode r"><code class="sourceCode r">vec &lt;-<span class="st"> </span><span class="dv">1</span>:<span class="dv">10</span>
<span class="kw">refset</span>(rvec, vec[<span class="dv">2</span>:<span class="dv">3</span>])
mylist &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">a=</span><span class="st">&quot;some&quot;</span>, <span class="dt">b=</span><span class="st">&quot;more&quot;</span>, <span class="dt">c=</span><span class="st">&quot;data&quot;</span>)
<span class="kw">refset</span>(rls, mylist$b)
<span class="kw">refset</span>(rls2, mylist[[<span class="st">&quot;c&quot;</span>]])
rvec</code></pre>
<pre><code>## [1] 2 3</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">c</span>(rls, rls2)</code></pre>
<pre><code>## [1] &quot;more&quot; &quot;data&quot;</code></pre>
<p>However, this won’t work:</p>
<pre class="sourceCode r"><code class="sourceCode r">myss &lt;-<span class="st"> </span><span class="kw">subset</span>(dfr, x1&gt;<span class="dv">1</span>)
<span class="kw">refset</span>(rs, myss)</code></pre>
<pre><code>## Error in substitute(data)[[1]]: object of type 'symbol' is not subsettable</code></pre>
<p>You have to specifically write out the subset you want: you can’t put it in a variable.</p>
<p>The second way to call <code>refset</code> is using the <code>%r%</code> infix operator. This is conveniently short, and also makes it clearer that you are assigning to a variable.</p>
<pre class="sourceCode r"><code class="sourceCode r">top4 %r%<span class="st"> </span>dfr[<span class="dv">1</span>:<span class="dv">4</span>,]
<span class="kw">exists</span>(<span class="st">&quot;top4&quot;</span>)</code></pre>
<pre><code>## [1] TRUE</code></pre>
<p>The last way to create a refset is the 3-or-more argument form of the function. This works like the <code>subset</code> command in R base: you can refer to data frame columns by name directly.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">refset</span>(large, dfr, x2 &gt;<span class="st"> </span><span class="dv">0</span>,)
large</code></pre>
<pre><code>##   x1        x2 alpha
## 1  1 1.5645495     A
## 2  2 0.8620767     B
## 5  5 1.7160819     z</code></pre>
<p>Notice that we’ve included an empty argument. This is just the same as when you call <code>dfr[dfr$x2 &gt; 0, ]</code> with an empty argument after the comma: it includes all the columns.</p>
</div>
<div id="dynamic-indexing" class="section level2">
<h2>Dynamic indexing</h2>
<p>Refsets don’t just sync their data with their “parent”. They also update their indices dynamically. For example, suppose we have a database of employees, including hours worked in the past month.</p>
<pre class="sourceCode r"><code class="sourceCode r">employees &lt;-<span class="st"> </span><span class="kw">data.frame</span>(
      <span class="dt">id=</span><span class="dv">1</span>:<span class="dv">4</span>, 
      <span class="dt">name=</span><span class="kw">c</span>(<span class="st">&quot;James&quot;</span>, <span class="st">&quot;Sylvia&quot;</span>, <span class="st">&quot;Meng Qi&quot;</span>, <span class="st">&quot;Luis&quot;</span>), 
      <span class="dt">age=</span><span class="kw">c</span>(<span class="dv">28</span>,<span class="dv">44</span>,<span class="dv">38</span>, <span class="dv">23</span>), 
      <span class="dt">gender=</span><span class="kw">factor</span>(<span class="kw">c</span>(<span class="st">&quot;M&quot;</span>, <span class="st">&quot;F&quot;</span>, <span class="st">&quot;F&quot;</span>, <span class="st">&quot;M&quot;</span>)),
      <span class="dt">hours=</span><span class="kw">c</span>(<span class="dv">160</span>, <span class="dv">130</span>, <span class="dv">185</span>, <span class="dv">145</span>),
      <span class="dt">pay=</span><span class="kw">c</span>(<span class="dv">60000</span>, <span class="dv">50000</span>, <span class="dv">70000</span>, <span class="dv">60000</span>),
      <span class="dt">stringsAsFactors=</span><span class="ot">FALSE</span>)</code></pre>
<p>We can create a refset of employees who worked overtime:</p>
<pre class="sourceCode r"><code class="sourceCode r">overtimers %r%<span class="st"> </span>employees[employees$hours &gt;<span class="st"> </span><span class="dv">140</span>,]
overtimers</code></pre>
<pre><code>##   id    name age gender hours   pay
## 1  1   James  28      M   160 60000
## 3  3 Meng Qi  38      F   185 70000
## 4  4    Luis  23      M   145 60000</code></pre>
<p>When the new monthly data comes in, the set of people in <code>overtimers</code> will change:</p>
<pre class="sourceCode r"><code class="sourceCode r">employees$hours &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">135</span>, <span class="dv">150</span>, <span class="dv">70</span>, <span class="dv">145</span>)
overtimers</code></pre>
<pre><code>##   id   name age gender hours   pay
## 2  2 Sylvia  44      F   150 50000
## 4  4   Luis  23      M   145 60000</code></pre>
<p>Sometimes you may wish to turn this behaviour off. For example, you may want to look at a particular subset that had a certain characteristic at a point in time. For this, use the argument <code>dyn.idx=FALSE</code> to <code>refset</code>.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># people who worked long hours last month:</span>
<span class="kw">refset</span>(overtimers_static, employees, hours &gt;<span class="st"> </span><span class="dv">140</span>, , <span class="dt">dyn.idx=</span><span class="ot">FALSE</span>)
<span class="co"># give them a holiday...</span>
overtimers_static$hours &lt;-<span class="st"> </span><span class="dv">0</span>
<span class="co"># ... and a pay rise</span>
overtimers_static$pay &lt;-<span class="st"> </span>overtimers_static$pay *<span class="st"> </span><span class="fl">1.1</span> 
overtimers_static</code></pre>
<pre><code>##   id   name age gender hours   pay
## 2  2 Sylvia  44      F     0 55000
## 4  4   Luis  23      M     0 66000</code></pre>
<p>Without the <code>dyn.idx=FALSE</code> argument, the refset would have zero rows after the call setting <code>hours</code> to 0.</p>
</div>
<div id="delinking-from-the-parent-and-using-parcels" class="section level2">
<h2>Delinking from the parent, and using parcels</h2>
<p>If you want to break the link to the parent dataset, simply assign your refset to a new variable.</p>
<pre class="sourceCode r"><code class="sourceCode r">copy &lt;-<span class="st"> </span>overtimers
copy$pay &lt;-<span class="st"> </span>copy$pay *<span class="st"> </span><span class="dv">2</span>
employees$pay <span class="co"># still the same :/</span></code></pre>
<pre><code>## [1] 60000 55000 70000 66000</code></pre>
<p>Refsets are implemented using an R feature called “active binding”, which calls a function when you access or change a variable. Reassigning to a new variable reassigns the contents, rather than the binding.</p>
<p>This causes a problem if you want to pass a reference into functions, rather than passing the value of the refset – for example, if you would like to change the refset in the body of the function, and have this affect the original data. When you use a refset in a function argument, it binds it to a new value, breaking the link with the parent.</p>
<p>If you are writing your own code, you can avoid this problem by <code>wrap</code>ping your refset into a “parcel” object. Parcels simply contain an expression and an environment in which the expression should be evaluated. For example, they can contain the name of a refset. When the <code>contents</code> function is called on a parcel, the expression is reevaluated. Here’s how to write a function that changes the name of our employees:</p>
<pre class="sourceCode r"><code class="sourceCode r">rs %r%<span class="st"> </span>employees[<span class="dv">1</span>:<span class="dv">3</span>,]</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">f &lt;-<span class="st"> </span>function(x) {
  cx &lt;-<span class="st"> </span><span class="kw">contents</span>(x)
  <span class="kw">contents</span>(x)$name &lt;-<span class="st"> </span><span class="kw">paste</span>(cx$name, <span class="st">&quot;the&quot;</span>, <span class="kw">sample</span>(<span class="kw">c</span>(<span class="st">&quot;Kid&quot;</span>, <span class="st">&quot;Terrible&quot;</span>, <span class="st">&quot;Silent&quot;</span>, 
        <span class="st">&quot;Fair&quot;</span>), <span class="kw">nrow</span>(cx), <span class="dt">replace=</span><span class="ot">TRUE</span>))
}

parcel &lt;-<span class="st"> </span><span class="kw">wrap</span>(rs)
<span class="kw">f</span>(parcel)
employees</code></pre>
<pre><code>##   id              name age gender hours   pay
## 1  1    James the Fair  28      M   135 60000
## 2  2 Sylvia the Silent  44      F     0 55000
## 3  3  Meng Qi the Fair  38      F    70 70000
## 4  4              Luis  23      M     0 66000</code></pre>
<p>As the above shows, you can assign to <code>contents(parcel)</code> as well as read from it. You can also create a new variable from the parcel by using <code>unwrap_as</code>. Another way to write the function above would be:</p>
<pre class="sourceCode r"><code class="sourceCode r">f &lt;-<span class="st"> </span>function(parcel) {
  <span class="kw">unwrap_as</span>(emps, parcel)
  emps$name &lt;-<span class="st"> </span><span class="kw">paste</span>(emps$name, <span class="st">&quot;the&quot;</span>, <span class="kw">sample</span>(<span class="kw">c</span>(<span class="st">&quot;Kid&quot;</span>, <span class="st">&quot;Terrible&quot;</span>, <span class="st">&quot;Silent&quot;</span>, 
        <span class="st">&quot;Fair&quot;</span>), <span class="kw">nrow</span>(emps), <span class="dt">replace=</span><span class="ot">TRUE</span>))
}
<span class="kw">f</span>(parcel)
employees</code></pre>
<pre><code>##   id                         name age gender hours   pay
## 1  1      James the Fair the Fair  28      M   135 60000
## 2  2 Sylvia the Silent the Silent  44      F     0 55000
## 3  3     Meng Qi the Fair the Kid  38      F    70 70000
## 4  4                         Luis  23      M     0 66000</code></pre>
<p>There is a shorthand function to create a wrapped refset, called (unsurprisingly) wrapset.</p>
<pre class="sourceCode r"><code class="sourceCode r">parcel &lt;-<span class="st"> </span><span class="kw">wrapset</span>(employees, <span class="kw">grepl</span>(<span class="st">&quot;Terrible&quot;</span>, employees$name), , <span class="dt">drop=</span><span class="ot">FALSE</span>)
<span class="co"># note: drop=FALSE works just as for standard subsetting, see ?Extract</span>
<span class="kw">contents</span>(parcel)</code></pre>
<pre><code>## [1] id     name   age    gender hours  pay   
## &lt;0 rows&gt; (or 0-length row.names)</code></pre>
<p>Using parcels is a way to pass references around code. You could also do this using non-standard evaluation (<a href="http://adv-r.had.co.nz/Computing-on-the-language.html">NSE</a>). Parcels have the nice feature that they store the environment where they should be evaluated.</p>
</div>
<div id="more-information" class="section level2">
<h2>More information</h2>
<p>For more information, see the help files for <code>refset</code> and <code>wrap</code>.</p>
<p>The code for refset lives at <a href="http://github.com/hughjonesd/refset">github</a>.</p>
</div>



<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
